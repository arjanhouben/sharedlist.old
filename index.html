<html>
	<head>
		<meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=yes">
		<style>
		html, body
		{
			background-color: #789;
			overflow: hidden;
			height: 100%;
			width: 100%;
			display: table;
		}
		.customfont
		{
			font-size: 20pt;
			font-family: sans-serif;
		}
		input[type=text]
		{
			background-color: transparent;
			border-color: black;
			border-width: 0 0 1px 0;
		}
		.strike > span
		{
			text-decoration: line-through;
		}
		.noselect
		{
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		.hidden
		{
			display: none;
		}
		ul
		{
			display: table-row;
			margin: 0;
			padding: 0;
			list-style-type: none;
			white-space: nowrap;
		}
		#scrollbox
		{
			height: 100%;
			overflow: auto;
		}
		#items
		{
			height: 100%;
		}
		li
		{
			padding: 5pt;
		}
		li > *
		{
			display: inline-block;
		}
		li > *:first-child
		{
			width: 70%;
			margin-right: 5%;
		}
		li > *:last-child
		{
			width: 25%;
		}
		.item
		{
		}
		</style>
		<script type="text/javascript" src="jquery-1.9.1.min.js"></script>
		<script type="text/javascript">
		$().ready(
			function()
			{
				var lastSynced = new Date();
				var container = $( "#scrollbox" );
				var emptyrow = $( "<li><span onclick=\"void(0)\" class=\"item noselect\"></span><input disabled=\"true\" class=\"remove\" type=\"button\" value=\"weghalen\" /></li>" );
				
				function getRow( item )
				{
					return item.parents( "li" );
				}
				
				function findItem( str )
				{
					var result = null;
					container.find( ".item" ).each(
						function( i, t )
						{
							if ( $(t).text() == str )
							{
								result = t;
								return false;
							}
						}
					);
					return $(result);
				}
				
				function updatePageJson( data )
				{
					return updatePage( JSON.parse( data ) );
				}
				
				function updatePage( data )
				{
					for ( var name in data[ "items" ] )
					{
						addRow( name );
						var i = findItem( name );
						var item = data[ "items" ][ name ];
						i.data( "modified", item[ "modified" ] );
						var row = getRow( i );
						row.addClass( item[ "state" ] );
						row.find( ".remove" ).attr( "disabled", !row.hasClass( "strike" ) );
					}
				}
				
				function getData()
				{
					var data = {
						"items": {}
					};
					container.find( ".item" ).each(
						function( i, t )
						{
							var str = $(t).text();
							if ( !str.length )
							{
								return;
							}
							var row = getRow( $(t) );
							data[ "items" ][ str ] = {
								"modified": $(t).data( "modified" ) || 0,
								"state": row.hasClass( "hidden" ) ? "hidden" : ( row.hasClass( "strike" ) ? "strike" : "active" )
							};
						}
					);
					return data;
				}
				
				function showError( str )
				{
					console.log( str );
				}
				
				function sync( data )
				{
					data = data || getData();
					
					$.ajax(
						"sync.php",
						{
							"data": data,
							"success": function( data )
							{
								updatePageJson( data );
								lastSynced = new Date();
							},
							"error": showError
						}
					)
				}
				
				function addRow( str )
				{
					if ( !str.length )
					{
						return;
					}
					var item = findItem( str );
					var row = getRow( item );
					if ( !item.length )
					{
						row = emptyrow.clone();
						row.find( ".item" ).text( str );
						container.append( row );
					}
					else if ( row.hasClass( "hidden" ) )
					{
						row.removeClass( "hidden" );
						row.removeClass( "strike" );
					}
				}
				
				function removeItem( str )
				{
					var row = getRow( findItem( str ) );
					if ( !row.length || row.hasClass( "hidden" ) )
					{
						return;
					}
					row.addClass( "hidden" );
				}
				
				var input = $("input[name=item]");
				
				$("#additem").on
				(
					"click",
					function( e )
					{
						addRow( input.val().trim() );
						sync();
						input.val( "" );
						e.preventDefault();
					}
				);
				
				function syncIfNeeded()
				{
					var now = new Date();
					if ( now.getTime() - lastSynced.getTime() > 5000 )
					{
						sync();
					}
				}
				
				$(this).on
				(
					"click",
					".item",
					function( e )
					{
						var row = getRow( $(this) );
						row.toggleClass( "strike" );
						row.find( ".remove" ).attr( "disabled", !row.hasClass( "strike" ) );
						sync();
					}
				).on
				(
					"click",
					".remove",
					function( e )
					{
						var str = getRow( $(this) ).find( ".item" ).text();
						removeItem( str );
						sync();
					}
				).on
				(
					"touchstart", syncIfNeeded
				).on
				(
					"mousedown", syncIfNeeded
				).on
				(
					"keyup",
					function( e )
					{
						if ( e.keyCode == 13 )
						{
							addRow( input.val().trim() );
							sync();
							input.val( "" );
						}
					}
				);
				
				function findMatching( str )
				{
					var result = [];
					for ( var i in getData().items )
					{
						if ( i.length > str.length && i.lastIndexOf( str, str.length ) === 0 )
						{
							result.push( i );
						}
					}
					return result;
				}
				
				function byLength( a, b )
				{
					return a.length > b.length;
				}
				
				function sameSize( len )
				{
					return function( a ) { return a.length === len; };
				}
				
				function suggest( str )
				{
					var i = input[ 0 ];
					var start = i.value.length;
					i.value = str;
					i.setSelectionRange( start, str.length );
					i.focus();
				}
				
				var nosuggest = false;
				
				input.on(
					"keydown",
					function( e )
					{
						switch ( e.keyCode )
						{
							case 8: // backspace
							case 46: // delete
								nosuggest = true;
								break;
							default:
								nosuggest = false;
						}
					}
				)
				
				input.on
				(
					"input",
					function( e )
					{
						this.value = this.value.toLowerCase();
						if ( nosuggest ) return;
						var str = this.value;
						if ( !str.length ) return;
						var matches = findMatching( str ).sort( byLength );
						if ( !matches.length ) return;
						matches = matches.filter( sameSize( matches[ 0 ].length ) );
						if ( matches.length === 1 )
						{
							suggest( matches[ 0 ] );
						}
					}
				);
				
				sync();
				
				input.focus();
			}
		);
		</script>
	</head>
	<body>
		<ul class="customfont">
			<li><input name="item" class="customfont" type="text" /><input id="additem" type="submit" value="toevoegen" /></li>
		</ul>
		<ul class="customfont" id="items">
			<div id="scrollbox">
			</div>
		</ul>
	</body>
</html>